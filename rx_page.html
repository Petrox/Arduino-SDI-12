<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.19"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SDI-12 for Arduino: Creating a Character - Stepping through the Rx ISR</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SDI-12 for Arduino
   &#160;<span id="projectnumber">2.1.0</span>
   </div>
   <div id="projectbrief">An Arduino library for SDI-12 communication without requiring any additional hardware.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.19 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('rx_page.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Creating a Character - Stepping through the Rx ISR </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#rx_specs">How a Character Looks in SDI-12</a></li>
<li class="level1"><a href="#rx_vars">Static Variables we Need</a></li>
<li class="level1"><a href="#rx_mask">Following the Mask</a><ul><li class="level2"><a href="#rx_mask_wait">Waiting for a Start Bit</a></li>
<li class="level2"><a href="#rx_mask_start">The Start of a Character</a></li>
<li class="level2"><a href="#rx_mask_fire">The Interrupt Fires!</a></li>
<li class="level2"><a href="#rx_mask_bit">Bit by Bit</a><ul><li class="level3"><a href="#rx_mask_low">A LOW/1 Bit</a></li>
<li class="level3"><a href="#rx_mask_high">A HIGH/0 Bit</a></li>
<li class="level3"><a href="#rx_mask_shift">Shifting Up</a></li>
</ul>
</li>
<li class="level2"><a href="#rx_mask_fin">A Finished Character</a></li>
</ul>
</li>
<li class="level1"><a href="#rx_fxn">The Full Interrupt Function</a></li>
</ul>
</div>
<div class="textblock"><p>Here we'll walk step-by-step through how the SDI-12 library (and NeoSWSerial) create a character from the ISR. Unlike SoftwareSerial which listens for a start bit and then halts all program and other ISR execution until the end of the character, this library grabs the time of the interrupt, does some quick math, and lets the processor move on. The logic of creating a character this way is harder for a person to follow, but it pays off because we're not tieing up the processor in an ISR that lasts for 8.33ms for each character. [10 bits @ 1200 bits/s] For a person, that 8.33ms is trivial, but for even a "slow" 8MHz processor, that's over 60,000 ticks sitting idle per character.</p>
<p>So, let's look at what's happening.</p>
<h1><a class="anchor" id="rx_specs"></a>
How a Character Looks in SDI-12</h1>
<p>First we need to keep in mind the specifications of SDI-12:</p><ul>
<li>We use <em>inverse logic</em> that means a "1" bit is at LOW level and a "0" bit is HIGH level.</li>
<li>characters are sent as 10 bits<ul>
<li>1 start bit, which is always a 0/HIGH</li>
<li>7 data bits</li>
<li>1 parity bit</li>
<li>1 stop bit, which is always 1/LOW</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="rx_vars"></a>
Static Variables we Need</h1>
<p>And lets remind ourselves of the static variables we're using to store states:</p><ul>
<li><code>prevBitTCNT</code> stores the time of the previous RX transition in micros</li>
<li><code>rxState</code> tracks how many bits are accounted for on an incoming character.<ul>
<li>if 0: indicates that we got a start bit</li>
<li>if &gt;0: indicates the number of bits received</li>
</ul>
</li>
<li><code>WAITING-FOR-START-BIT</code> is a mask for the rxState while waiting for a start bit, it's set to 0b11111111</li>
<li><code>rxMask</code> is a bit mask for building a received character<ul>
<li>The mask has a single bit set, in the place of the active bit based on the rxState</li>
</ul>
</li>
<li><code>rxValue</code> is the value of the character being built</li>
</ul>
<h1><a class="anchor" id="rx_mask"></a>
Following the Mask</h1>
<h2><a class="anchor" id="rx_mask_wait"></a>
Waiting for a Start Bit</h2>
<p>The <code>rxState</code>, <code>rxMask</code>, and <code>rxValue</code> all work together to form a character. When we're waiting for a start bit <code>rxValue</code> is empty, <code>rxMask</code> has only the bottom bit set, and <code>rxState</code> is set to WAITING-FOR-START-BIT:</p>
<div class="fragment"><div class="line">    rxValue: |     0   0   0   0   0   0   0   0</div>
<div class="line">-------------|-----------------------------------</div>
<div class="line">     rxMask: |     0   0   0   0   0   0   0   1</div>
<div class="line">    rxState: |     1   1   1   1   1   1   1   1</div>
</div><!-- fragment --><h2><a class="anchor" id="rx_mask_start"></a>
The Start of a Character</h2>
<p>After we get a start bit, the <code>startChar()</code> function creates a blank slate for the new character, so our values are:</p>
<div class="fragment"><div class="line">    rxValue: |     0   0   0   0   0   0   0   0</div>
<div class="line">-------------|-----------------------------------</div>
<div class="line">     rxMask: |     0   0   0   0   0   0   0   1</div>
<div class="line">    rxState: |     0   0   0   0   0   0   0   0</div>
</div><!-- fragment --><h2><a class="anchor" id="rx_mask_fire"></a>
The Interrupt Fires!</h2>
<p>When an interrupts is received, we use capture the time if the interrupt in <code>thisBitTCNT</code>. Then we subtract <code>prevBitTCNT</code> from <code>thisBitTCNT</code> and use the <code>bitTimes()</code> function to calculate how many bit-times have passed between this interrupt and the previous one. (There's also a fudge factor in this calculation we call the <a href="https://github.com/SlashDevin/NeoSWSerial/pull/13#issuecomment-315463522">rxWindowWidth</a>.)</p>
<h2><a class="anchor" id="rx_mask_bit"></a>
Bit by Bit</h2>
<p>For <b>each bit time that passed</b>, we apply the <code>rxMask</code> to the <code>rxValue</code>.</p><ul>
<li>Keep in mind multiple bit times can pass between interrupts - this happens any time there are two (or more) high or low bits in a row.</li>
<li>We also leave time for the (high) start and (low) stop bit, but do anything with the <code>rxState</code>, <code>rxMask</code>, or <code>rxValue</code> for those bits.</li>
</ul>
<h3><a class="anchor" id="rx_mask_low"></a>
A LOW/1 Bit</h3>
<ul>
<li>if the data bit received is LOW (1) we do an <code>|=</code> (bitwise OR) between the <code>rxMask</code> and the <code>rxValue</code></li>
</ul>
<div class="fragment"><div class="line">    rxValue: |     0   0   0   0   0   0   0   1</div>
<div class="line">-------------|---------------------------------^- bit-wise or puts the one</div>
<div class="line">     rxMask: |     0   0   0   0   0   0   0   1      from the rxMask into</div>
<div class="line">    rxState: |     0   0   0   0   0   0   0   0      the rxValue</div>
</div><!-- fragment --><h3><a class="anchor" id="rx_mask_high"></a>
A HIGH/0 Bit</h3>
<ul>
<li>if the data bit received is HIGH (0) we do nothing</li>
</ul>
<div class="fragment"><div class="line">    rxValue: |     0   0   0   0   0   0   0   0</div>
<div class="line">-------------|---------------------------------x- nothing happens</div>
<div class="line">     rxMask: |     0   0   0   0   0   0   0   1</div>
<div class="line">    rxState: |     0   0   0   0   0   0   0   0</div>
</div><!-- fragment --><h3><a class="anchor" id="rx_mask_shift"></a>
Shifting Up</h3>
<ul>
<li><em>After</em> applying the mask, we push everything over one bit to the left. The top bit falls off.<ul>
<li>we always add a 1 on the <code>rxState</code>, to indicate the bit arrived</li>
<li>we always add a 0 on the <code>rxMask</code> and the <code>rxValue</code></li>
<li>the values of the second bit of the <code>rxValue</code> (?) depends on what we did in the step above</li>
</ul>
</li>
</ul>
<div class="fragment"><div class="line">    rxValue: |     0        &lt;--- | 0   0   0   0   0   0   ?   0 &lt;--- add a zero</div>
<div class="line">-------------|-------------------|---------------------------|---</div>
<div class="line">     rxMask: |     0        &lt;--- | 0   0   0   0   0   0   1   0 &lt;--- add a zero</div>
<div class="line">    rxState: |     0        &lt;--- | 0   0   0   0   0   0   0   1 &lt;--- add a one</div>
<div class="line">-------------|-------------------|---------------------------|---</div>
<div class="line">             | falls off the top |                           | added to the bottom</div>
</div><!-- fragment --><h2><a class="anchor" id="rx_mask_fin"></a>
A Finished Character</h2>
<p>After 8 bit times have passed, we should have a fully formed character with 8 bits of data (7 of the character + 1 parity). The <code>rxMask</code> will have the one in the top bit. And the rxState will be filled - which just happens to be the value of <code>WAITING-FOR-START-BIT</code> for the next character.</p>
<div class="fragment"><div class="line">    rxValue: |     ?   ?   ?   ?   ?   ?   ?   ?</div>
<div class="line">-------------|-----------------------------------</div>
<div class="line">     rxMask: |     1   0   0   0   0   0   0   0</div>
<div class="line">    rxState: |     1   1   1   1   1   1   1   1</div>
</div><!-- fragment --><h1><a class="anchor" id="rx_fxn"></a>
The Full Interrupt Function</h1>
<p>Understanding how the masking creates the character, you should now be able to follow the full interrupt function below.</p>
<div class="fragment"><div class="line"><span class="comment">// Creates a blank slate of bits for an incoming character</span></div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="group__interrupt__fxns.html#gae92237f6179c437a32391dc3689506d5">SDI12::startChar</a>() {</div>
<div class="line">  <a class="code" href="group__sdi12__statics.html#gafc41ba83e116964cd32424fa01916d96">rxState</a> = 0x00;  <span class="comment">// 0b00000000, got a start bit</span></div>
<div class="line">  <a class="code" href="group__sdi12__statics.html#ga805a0624c9ec5fdfd6d8f1df1461ec60">rxMask</a>  = 0x01;  <span class="comment">// 0b00000001, bit mask, lsb first</span></div>
<div class="line">  <a class="code" href="group__sdi12__statics.html#ga432c6f5ea7e6d3662aea777cc215b9c0">rxValue</a> = 0x00;  <span class="comment">// 0b00000000, RX character to be, a blank slate</span></div>
<div class="line">}  <span class="comment">// startChar</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// The actual interrupt service routine</span></div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="group__interrupt__fxns.html#gaf28fbdc8916b675bdc016209aaf86d90">SDI12::receiveISR</a>() {</div>
<div class="line">  <span class="comment">// time of this data transition (plus ISR latency)</span></div>
<div class="line">  <a class="code" href="group__sdi12__statics.html#gaeaff7022e63d07efdace2c8d6b324d5c">sdi12timer</a>-t thisBitTCNT = <a class="code" href="_s_d_i12_8h.html#a5261e90ea3b53cca5dd95bdf1749d9d9">READTIME</a>;</div>
<div class="line"> </div>
<div class="line">  uint8-t pinLevel = digitalRead(-dataPin);  <span class="comment">// current RX data level</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Check if we&#39;re ready for a start bit, and if this could possibly be it.</span></div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__sdi12__statics.html#gafc41ba83e116964cd32424fa01916d96">rxState</a> == WAITING-FOR-START-BIT) {</div>
<div class="line">    <span class="comment">// If we are waiting for a start bit and the pin is low it&#39;s not a start bit, exit</span></div>
<div class="line">    <span class="comment">// Inverse logic start bit = HIGH</span></div>
<div class="line">    <span class="keywordflow">if</span> (pinLevel == LOW) { <span class="keywordflow">return</span>; }</div>
<div class="line">    <span class="comment">// If the pin is HIGH, this should be a start bit.</span></div>
<div class="line">    <span class="comment">// Thus startChar(), which sets the rxState to 0, create an empty character, and a</span></div>
<div class="line">    <span class="comment">// new mask with a 1 in the lowest place</span></div>
<div class="line">    <a class="code" href="group__interrupt__fxns.html#gae92237f6179c437a32391dc3689506d5">startChar</a>();</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="comment">// If we&#39;re not waiting for a start bit, it&#39;s because we&#39;re in the middle of an</span></div>
<div class="line">    <span class="comment">// incomplete character and therefore this change in the pin state must be from a</span></div>
<div class="line">    <span class="comment">// data, parity, or stop bit.</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Check how many bit times have passed since the last change</span></div>
<div class="line">    uint16-t rxBits = <a class="code" href="group__sdi12__statics.html#ga09e47933b6613fa73325d3a9c61db36c">bitTimes</a>((uint8-t)(thisBitTCNT - <a class="code" href="group__sdi12__statics.html#gac568c972269e3105012111199c7372c3">prevBitTCNT</a>));</div>
<div class="line">    <span class="comment">// Calculate how many *data+parity* bits should be left in the current character</span></div>
<div class="line">    <span class="comment">//      - Each character has a total of 10 bits, 1 start bit, 7 data bits, 1 parity</span></div>
<div class="line">    <span class="comment">// bit, and 1 stop bit</span></div>
<div class="line">    <span class="comment">//      - The #rxState holds record of how many of the data + parity bits we&#39;ve</span></div>
<div class="line">    <span class="comment">// gotten (up to 8)</span></div>
<div class="line">    <span class="comment">//      - We have to treat the parity bit as a data bit because we don&#39;t know its</span></div>
<div class="line">    <span class="comment">// state</span></div>
<div class="line">    <span class="comment">//      - Since we&#39;re mid character, we know the start bit is past which knocks us</span></div>
<div class="line">    <span class="comment">// down to 9</span></div>
<div class="line">    <span class="comment">//      - There will always be one left over for the stop bit, which will be LOW/1</span></div>
<div class="line">    uint8-t bitsLeft = 9 - <a class="code" href="group__sdi12__statics.html#gafc41ba83e116964cd32424fa01916d96">rxState</a>;</div>
<div class="line">    <span class="comment">// If the number of bits passed since the last transition is more than then number</span></div>
<div class="line">    <span class="comment">// of bits left on the character we were working on, a new character must have</span></div>
<div class="line">    <span class="comment">// started.</span></div>
<div class="line">    <span class="comment">// This will happen if the parity bit is 1 or the last bit(s) of the character and</span></div>
<div class="line">    <span class="comment">// the parity bit are all 1&#39;s.</span></div>
<div class="line">    <span class="keywordtype">bool</span> nextCharStarted = (rxBits &gt; bitsLeft);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Check how many data+parity bits have been sent in this frame.  This will be</span></div>
<div class="line">    <span class="comment">// different from the rxBits if a new character has started because of the start</span></div>
<div class="line">    <span class="comment">// and stop bits.</span></div>
<div class="line">    <span class="comment">//      - If the total number of bits in this frame is more than the number of</span></div>
<div class="line">    <span class="comment">// data+parity bits remaining in the character, then the number of data+parity bits</span></div>
<div class="line">    <span class="comment">// is equal to the number of bits remaining for the character and partiy.</span></div>
<div class="line">    <span class="comment">//      - If the total number of bits in this frame is less than the number of data</span></div>
<div class="line">    <span class="comment">// bits left for the character and parity, then the number of data+parity bits</span></div>
<div class="line">    <span class="comment">// received in this frame is equal to the total number of bits received in this</span></div>
<div class="line">    <span class="comment">// frame.</span></div>
<div class="line">    <span class="comment">// translation:</span></div>
<div class="line">    <span class="comment">//    if nextCharStarted then bitsThisFrame = bitsLeft</span></div>
<div class="line">    <span class="comment">//                       else bitsThisFrame = rxBits</span></div>
<div class="line">    uint8-t bitsThisFrame = nextCharStarted ? bitsLeft : rxBits;</div>
<div class="line">    <span class="comment">// Tick up the rxState by the number of data+parity bits received in the frame</span></div>
<div class="line">    <a class="code" href="group__sdi12__statics.html#gafc41ba83e116964cd32424fa01916d96">rxState</a> += bitsThisFrame;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Set all the bits received between the last change and this change</span></div>
<div class="line">    <span class="keywordflow">if</span> (pinLevel == HIGH) {</div>
<div class="line">      <span class="comment">// If the current state is HIGH (and it just became so), then all bits between</span></div>
<div class="line">      <span class="comment">// the last change and now must have been LOW.</span></div>
<div class="line">      <span class="comment">// back fill previous bits with 1&#39;s (inverse logic - LOW = 1)</span></div>
<div class="line">      <span class="keywordflow">while</span> (bitsThisFrame-- &gt; 0) {</div>
<div class="line">        <span class="comment">// for each of the bits that happened in this frame</span></div>
<div class="line"> </div>
<div class="line">        <a class="code" href="group__sdi12__statics.html#ga432c6f5ea7e6d3662aea777cc215b9c0">rxValue</a> |= <a class="code" href="group__sdi12__statics.html#ga805a0624c9ec5fdfd6d8f1df1461ec60">rxMask</a>;     <span class="comment">// Add a 1 to the LSB/right-most place of our character</span></div>
<div class="line">                               <span class="comment">// value from the mask</span></div>
<div class="line">        <a class="code" href="group__sdi12__statics.html#ga805a0624c9ec5fdfd6d8f1df1461ec60">rxMask</a> = <a class="code" href="group__sdi12__statics.html#ga805a0624c9ec5fdfd6d8f1df1461ec60">rxMask</a> &lt;&lt; 1;  <span class="comment">// Shift the 1 in the mask up by one position</span></div>
<div class="line">      }</div>
<div class="line">      <span class="comment">// And shift the 1 in the mask up by one more position for the current bit.</span></div>
<div class="line">      <span class="comment">// It&#39;s HIGH/0 now, so we don&#39;t use `|=` with the mask for this last one.</span></div>
<div class="line">      <a class="code" href="group__sdi12__statics.html#ga805a0624c9ec5fdfd6d8f1df1461ec60">rxMask</a> = <a class="code" href="group__sdi12__statics.html#ga805a0624c9ec5fdfd6d8f1df1461ec60">rxMask</a> &lt;&lt; 1;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <span class="comment">// If the current state is LOW (and it just became so), then this bit is LOW</span></div>
<div class="line">      <span class="comment">// but all bits between the last change and now must have been HIGH</span></div>
<div class="line"> </div>
<div class="line">      <span class="comment">// pinLevel==LOW</span></div>
<div class="line">      <span class="comment">// previous bits were 0&#39;s so only this bit is a 1 (inverse logic - LOW = 1)</span></div>
<div class="line">      <a class="code" href="group__sdi12__statics.html#ga805a0624c9ec5fdfd6d8f1df1461ec60">rxMask</a> = <a class="code" href="group__sdi12__statics.html#ga805a0624c9ec5fdfd6d8f1df1461ec60">rxMask</a> &lt;&lt; (bitsThisFrame -</div>
<div class="line">                          1);  <span class="comment">// Shift the 1 in the mask up by the number of bits past</span></div>
<div class="line">      <a class="code" href="group__sdi12__statics.html#ga432c6f5ea7e6d3662aea777cc215b9c0">rxValue</a> |= <a class="code" href="group__sdi12__statics.html#ga805a0624c9ec5fdfd6d8f1df1461ec60">rxMask</a>;  <span class="comment">//  And add that shifted one to the character being created</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// If this was the 8th or more bit then the character and parity are complete.</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__sdi12__statics.html#gafc41ba83e116964cd32424fa01916d96">rxState</a> &gt; 7) {</div>
<div class="line">      <a class="code" href="group__sdi12__statics.html#ga432c6f5ea7e6d3662aea777cc215b9c0">rxValue</a> &amp;= 0x7F;        <span class="comment">// Throw away the parity bit (and with 0b01111111)</span></div>
<div class="line">      <a class="code" href="group__interrupt__fxns.html#ga8b5c579dc5b10b44ff4b24945ce54e91">charToBuffer</a>(<a class="code" href="group__sdi12__statics.html#ga432c6f5ea7e6d3662aea777cc215b9c0">rxValue</a>);  <span class="comment">// Put the finished character into the buffer</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">      <span class="comment">// if this is LOW, or we haven&#39;t exceeded the number of bits in a</span></div>
<div class="line">      <span class="comment">// character (but have gotten all the data bits) then this should be a</span></div>
<div class="line">      <span class="comment">// stop bit and we can start looking for a new start bit.</span></div>
<div class="line">      <span class="keywordflow">if</span> ((pinLevel == LOW) || !nextCharStarted) {</div>
<div class="line">        <a class="code" href="group__sdi12__statics.html#gafc41ba83e116964cd32424fa01916d96">rxState</a> = WAITING-FOR-START-BIT;  <span class="comment">// DISABLE STOP BIT TIMER</span></div>
<div class="line">      } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="comment">// If we just switched to HIGH, or we&#39;ve exceeded the total number of</span></div>
<div class="line">        <span class="comment">// bits in a character, then the character must have ended with 1&#39;s/LOW,</span></div>
<div class="line">        <span class="comment">// and this new 0/HIGH is actually the start bit of the next character.</span></div>
<div class="line">        <a class="code" href="group__interrupt__fxns.html#gae92237f6179c437a32391dc3689506d5">startChar</a>();</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="group__sdi12__statics.html#gac568c972269e3105012111199c7372c3">prevBitTCNT</a> = thisBitTCNT;  <span class="comment">// finally remember time stamp of this change!</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Put a new character in the buffer</span></div>
<div class="line"><span class="keywordtype">void</span> <a class="code" href="group__interrupt__fxns.html#ga8b5c579dc5b10b44ff4b24945ce54e91">SDI12::charToBuffer</a>(uint8-t c) {</div>
<div class="line">  <span class="comment">// Check for a buffer overflow. If not, proceed.</span></div>
<div class="line">  <span class="keywordflow">if</span> ((-rxBufferTail + 1) % <a class="code" href="class_s_d_i12.html">SDI12</a>-BUFFER-SIZE == -rxBufferHead) {</div>
<div class="line">    -bufferOverflow = <span class="keyword">true</span>;</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="comment">// Save the character, advance buffer tail.</span></div>
<div class="line">    -rxBuffer[-rxBufferTail] = c;</div>
<div class="line">    -rxBufferTail            = (-rxBufferTail + 1) % <a class="code" href="class_s_d_i12.html">SDI12</a>-BUFFER-SIZE;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="agroup__interrupt__fxns_html_gae92237f6179c437a32391dc3689506d5"><div class="ttname"><a href="group__interrupt__fxns.html#gae92237f6179c437a32391dc3689506d5">SDI12::startChar</a></div><div class="ttdeci">void startChar()</div><div class="ttdoc">Creates a blank slate for a new incoming character.</div><div class="ttdef"><b>Definition:</b> SDI12.cpp:566</div></div>
<div class="ttc" id="agroup__sdi12__statics_html_gac568c972269e3105012111199c7372c3"><div class="ttname"><a href="group__sdi12__statics.html#gac568c972269e3105012111199c7372c3">SDI12::prevBitTCNT</a></div><div class="ttdeci">static uint16_t prevBitTCNT</div><div class="ttdoc">Stores the time of the previous RX transition in micros.</div><div class="ttdef"><b>Definition:</b> SDI12.h:246</div></div>
<div class="ttc" id="agroup__sdi12__statics_html_ga805a0624c9ec5fdfd6d8f1df1461ec60"><div class="ttname"><a href="group__sdi12__statics.html#ga805a0624c9ec5fdfd6d8f1df1461ec60">SDI12::rxMask</a></div><div class="ttdeci">static uint8_t rxMask</div><div class="ttdoc">a bit mask for building a received character</div><div class="ttdef"><b>Definition:</b> SDI12.h:260</div></div>
<div class="ttc" id="aclass_s_d_i12_html"><div class="ttname"><a href="class_s_d_i12.html">SDI12</a></div><div class="ttdoc">The main class for SDI 12 instances.</div><div class="ttdef"><b>Definition:</b> SDI12.h:194</div></div>
<div class="ttc" id="agroup__interrupt__fxns_html_ga8b5c579dc5b10b44ff4b24945ce54e91"><div class="ttname"><a href="group__interrupt__fxns.html#ga8b5c579dc5b10b44ff4b24945ce54e91">SDI12::charToBuffer</a></div><div class="ttdeci">void charToBuffer(uint8_t c)</div><div class="ttdoc">Put a finished character into the SDI12 buffer.</div><div class="ttdef"><b>Definition:</b> SDI12.cpp:679</div></div>
<div class="ttc" id="a_s_d_i12_8h_html_a5261e90ea3b53cca5dd95bdf1749d9d9"><div class="ttname"><a href="_s_d_i12_8h.html#a5261e90ea3b53cca5dd95bdf1749d9d9">READTIME</a></div><div class="ttdeci">#define READTIME</div><div class="ttdoc">The function or macro used to read the clock timer value.</div><div class="ttdef"><b>Definition:</b> SDI12.h:188</div></div>
<div class="ttc" id="agroup__sdi12__statics_html_ga09e47933b6613fa73325d3a9c61db36c"><div class="ttname"><a href="group__sdi12__statics.html#ga09e47933b6613fa73325d3a9c61db36c">SDI12::bitTimes</a></div><div class="ttdeci">static uint16_t bitTimes(uint8_t dt)</div><div class="ttdoc">static method for calculating the number of bit-times that have elapsed given an 8-bit counter/timer ...</div><div class="ttdef"><b>Definition:</b> SDI12.cpp:86</div></div>
<div class="ttc" id="agroup__sdi12__statics_html_gaeaff7022e63d07efdace2c8d6b324d5c"><div class="ttname"><a href="group__sdi12__statics.html#gaeaff7022e63d07efdace2c8d6b324d5c">SDI12::sdi12timer</a></div><div class="ttdeci">static SDI12Timer sdi12timer</div><div class="ttdoc">The SDI12Timer instance to use for checking bit reception times.</div><div class="ttdef"><b>Definition:</b> SDI12.h:209</div></div>
<div class="ttc" id="agroup__sdi12__statics_html_ga432c6f5ea7e6d3662aea777cc215b9c0"><div class="ttname"><a href="group__sdi12__statics.html#ga432c6f5ea7e6d3662aea777cc215b9c0">SDI12::rxValue</a></div><div class="ttdeci">static uint8_t rxValue</div><div class="ttdoc">the value of the character being built</div><div class="ttdef"><b>Definition:</b> SDI12.h:264</div></div>
<div class="ttc" id="agroup__interrupt__fxns_html_gaf28fbdc8916b675bdc016209aaf86d90"><div class="ttname"><a href="group__interrupt__fxns.html#gaf28fbdc8916b675bdc016209aaf86d90">SDI12::receiveISR</a></div><div class="ttdeci">void receiveISR()</div><div class="ttdoc">The interrupt service routine (ISR) - the function responding to changes in rx line state.</div><div class="ttdef"><b>Definition:</b> SDI12.cpp:573</div></div>
<div class="ttc" id="agroup__sdi12__statics_html_gafc41ba83e116964cd32424fa01916d96"><div class="ttname"><a href="group__sdi12__statics.html#gafc41ba83e116964cd32424fa01916d96">SDI12::rxState</a></div><div class="ttdeci">static uint8_t rxState</div><div class="ttdoc">Tracks how many bits are accounted for on an incoming character.</div><div class="ttdef"><b>Definition:</b> SDI12.h:253</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.19 </li>
  </ul>
</div>
</body>
</html>
